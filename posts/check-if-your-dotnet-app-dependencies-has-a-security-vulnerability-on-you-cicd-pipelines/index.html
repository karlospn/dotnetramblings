<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>How to easily check on your CI/CD pipelines if your app has a NuGet package with a security vulnerability :: my tech ramblings — A blog for writing about my techie ramblings</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Just show me the code
As always, if you don’t care about the post I have uploaded the source code on my Github.
Almost any dotnet application contains several NuGet dependencies, and those dependencies may have their own dependencies, and so on and so forth. This means that your application ends up depending on dozens of external dependencies.
What if any of those dependencies you&amp;rsquo;re using are vulnerable? That could pose a risk of a supply chain attack."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://www.mytechramblings.com/posts/check-if-your-dotnet-app-dependencies-has-a-security-vulnerability-on-you-cicd-pipelines/" />





<link rel="stylesheet" href="https://www.mytechramblings.com/assets/style.css">


<link rel="stylesheet" href="https://www.mytechramblings.com/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.mytechramblings.com/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://www.mytechramblings.com/img/favicon.png">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How to easily check on your CI/CD pipelines if your app has a NuGet package with a security vulnerability">
  <meta name="twitter:description" content="Almost any dotnet application has several NuGet dependencies, and those dependencies may have their own dependencies, and so on and so forth. What if any of those dependencies you&#39;re using contains a security vulnerability? You can check on your CI/CD pipeline if your application has any known NuGet vulnerability with just a couple of lines of bash script.">



<meta property="og:url" content="https://www.mytechramblings.com/posts/check-if-your-dotnet-app-dependencies-has-a-security-vulnerability-on-you-cicd-pipelines/">
  <meta property="og:site_name" content="my tech ramblings">
  <meta property="og:title" content="How to easily check on your CI/CD pipelines if your app has a NuGet package with a security vulnerability">
  <meta property="og:description" content="Almost any dotnet application has several NuGet dependencies, and those dependencies may have their own dependencies, and so on and so forth. What if any of those dependencies you&#39;re using contains a security vulnerability? You can check on your CI/CD pipeline if your application has any known NuGet vulnerability with just a couple of lines of bash script.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-08-09T10:01:21+02:00">
    <meta property="article:modified_time" content="2022-08-09T10:01:21+02:00">
    <meta property="article:tag" content="Devops">
    <meta property="article:tag" content="Dotnet">
    <meta property="article:tag" content="Nuget">






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="https://www.mytechramblings.com/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">my tech ramblings</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="https://www.dotnetramblings.com">.NET News</a></li>
        
      
        
          <li><a href="/about">About</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="https://www.dotnetramblings.com">.NET News</a></li>
      
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="https://www.mytechramblings.com/posts/check-if-your-dotnet-app-dependencies-has-a-security-vulnerability-on-you-cicd-pipelines/">How to easily check on your CI/CD pipelines if your app has a NuGet package with a security vulnerability</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2022-08-09
        </span>

        
          
            



          
        
      

      
      
        <span class="post-read-time">— 11 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="https://www.mytechramblings.com/tags/devops/">devops</a>&nbsp;
        
          #<a href="https://www.mytechramblings.com/tags/dotnet/">dotnet</a>&nbsp;
        
          #<a href="https://www.mytechramblings.com/tags/nuget/">nuget</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <blockquote>
<p><strong>Just show me the code</strong><br>
As always, if you don’t care about the post I have uploaded the source code on my <a href="https://github.com/karlospn/check-nuget-packages-for-security-vulnerabilities">Github</a>.</p>
</blockquote>
<p>Almost any dotnet application contains several NuGet dependencies, and those dependencies may have their own dependencies, and so on and so forth. This means that your application ends up depending on dozens of external dependencies.</p>
<p>What if any of those dependencies you&rsquo;re using are vulnerable? That could pose a risk of a supply chain attack.<br>
What is software supply chain attack?  It is an upstream vulnerability in one of your dependencies that can be fatal, making your app vulnerable to a potential compromise.</p>
<p>The term supply chain is used to refer to everything that goes into your software and where it comes from. It is the dependencies that your software supply chain depends on. A dependency can be code, binaries, or other components, and where they come from, such as a repository or package manager.</p>
<p>If you don&rsquo;t live under a rock, then you&rsquo;ve likely heard about last year Log4j vulnerability, this was a software supply chain vulnerability in which having the popular Java logging framework installed on your app could compromise your business.</p>
<p>There are quite a few well-known tools that will allow you to scan your app for vulnerable dependencies, also if your project is hosted on GitHub you can leverage GitHub Security to find vulnerable dependencies and Dependabot will fix them by opening up a pull request against your codebase.</p>
<p>Right now, if you are not checking anywhere on your deployment pipeline if your application has any known NuGet security vulnerability, you should know that the <strong>dotnet CLI is capable of doing that analysis without the need of any kind of external tool</strong>.</p>
<h1 id="how-to-use-the-net-cli-to-check-if-your-app-has-any-vulnerable-nuget-dependency"><strong>How to use the .NET CLI to check if your app has any vulnerable NuGet dependency</strong></h1>
<p>You can list any known vulnerabilities in your dependencies within your projects using the <code>dotnet list package --vulnerable</code> command.</p>
<p>This command gets the security information from the centralized GitHub Advisory Database. This database provides two main listings of vulnerabilities:</p>
<ul>
<li>A CVE is Common Vulnerabilities and Exposures. This is a list of publicly disclosed computer security flaws.</li>
<li>A GHSA is a GitHub Security Advisory. GitHub is a CVE Numbering Authority (CNA) and is authorized to assign CVE identification numbers.</li>
</ul>
<p>To use this feature you&rsquo;ll need to have installed the <strong>.NET SDK version 5.0.200</strong> (or higher).</p>
<p>The <code>dotnet list package --vulnerable</code> command only works with projects that are using the <code>PackageReference</code> format, which means that you won&rsquo;t be able to use it if your project still uses the <code>packages.config</code> format.</p>
<p>Let me show you an example.<br>
I have built a .NET5 N-Layer application that has a few NuGet vulnerabilities, and here&rsquo;s how the output of the <code>dotnet list package --vulnerable</code> command  looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>The following sources were used:
</span></span><span style="display:flex;"><span>   https://api.nuget.org/v3/index.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Library.Contracts<span style="color:#e6db74">`</span> has no vulnerable packages given the current sources.
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Library.Impl<span style="color:#e6db74">`</span> has no vulnerable packages given the current sources.
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Repository.Contracts<span style="color:#e6db74">`</span> has no vulnerable packages given the current sources.
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Repository.Impl<span style="color:#e6db74">`</span> has no vulnerable packages given the current sources.
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Core.Extensions<span style="color:#e6db74">`</span> has the following vulnerable packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package      Requested   Resolved   Severity   Advisory URL                                     
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json      12.0.3      12.0.3     High       https://github.com/advisories/GHSA-5crp-9r3c-p9vr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.WebApi<span style="color:#e6db74">`</span> has the following vulnerable packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>net5.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                                    Requested   Resolved   Severity   Advisory URL                                     
</span></span><span style="display:flex;"><span>   &gt; Microsoft.AspNetCore.Authentication.JwtBearer      5.0.6       5.0.6      Moderate   https://github.com/advisories/GHSA-q7cg-43mg-qp69
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json                                    12.0.3      12.0.3     High       https://github.com/advisories/GHSA-5crp-9r3c-p9vr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.WebApi.IntegrationTest<span style="color:#e6db74">`</span> has no vulnerable packages given the current sources.
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Library.Impl.UnitTest<span style="color:#e6db74">`</span> has no vulnerable packages given the current sources.
</span></span></code></pre></div><p>As you can see this command will tell you if there are any packages that contains a vulnerability, the severity of the vulnerability, and a link with more information about the vulnerability.</p>
<p>The &ldquo;Requested&rdquo; and &ldquo;Resolved&rdquo; columns might lead to confusion, so let me explain what they mean:</p>
<ul>
<li>The &ldquo;Requested&rdquo; column will include the version that the developer has indicated in the package reference within the project file, which means it can be a range.</li>
<li>The &ldquo;Resolved&rdquo; column will include the version that the project is currently using and will always be a single value.</li>
</ul>
<p>The <code>dotnet list package --vulnerable</code> command <strong>ONLY</strong> checks direct dependencies, which means that it will only scan the NuGet packages that are directly installed on your app (top-level packages). <br>
If you are interested in seeing vulnerabilities within your dependencies as well, you&rsquo;ll need to use the <code>--include-transitive</code> parameter, like this <code>dotnet list package --vulnerable --include-transitive</code>.</p>
<p>Let&rsquo;s execute the <code>dotnet list package --vulnerable --include-transitive</code> command on the same app.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>The following sources were used:
</span></span><span style="display:flex;"><span>   https://api.nuget.org/v3/index.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Library.Contracts<span style="color:#e6db74">`</span> has the following vulnerable packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Transitive Package      Resolved   Severity   Advisory URL                                     
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json       12.0.3     High       https://github.com/advisories/GHSA-5crp-9r3c-p9vr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Library.Impl<span style="color:#e6db74">`</span> has the following vulnerable packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Transitive Package      Resolved   Severity   Advisory URL                                     
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json       12.0.3     High       https://github.com/advisories/GHSA-5crp-9r3c-p9vr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Repository.Contracts<span style="color:#e6db74">`</span> has no vulnerable packages given the current sources.
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Repository.Impl<span style="color:#e6db74">`</span> has no vulnerable packages given the current sources.
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Core.Extensions<span style="color:#e6db74">`</span> has the following vulnerable packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package      Requested   Resolved   Severity   Advisory URL                                     
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json      12.0.3      12.0.3     High       https://github.com/advisories/GHSA-5crp-9r3c-p9vr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.WebApi<span style="color:#e6db74">`</span> has the following vulnerable packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>net5.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                                    Requested   Resolved   Severity   Advisory URL                                     
</span></span><span style="display:flex;"><span>   &gt; Microsoft.AspNetCore.Authentication.JwtBearer      5.0.6       5.0.6      Moderate   https://github.com/advisories/GHSA-q7cg-43mg-qp69
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json                                    12.0.3      12.0.3     High       https://github.com/advisories/GHSA-5crp-9r3c-p9vr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.WebApi.IntegrationTest<span style="color:#e6db74">`</span> has the following vulnerable packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>net5.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Transitive Package                                   Resolved   Severity   Advisory URL                                     
</span></span><span style="display:flex;"><span>   &gt; Microsoft.AspNetCore.Authentication.JwtBearer      5.0.6      Moderate   https://github.com/advisories/GHSA-q7cg-43mg-qp69
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json                                    12.0.3     High       https://github.com/advisories/GHSA-5crp-9r3c-p9vr
</span></span><span style="display:flex;"><span>   &gt; System.Net.Http                                    4.3.0      High       https://github.com/advisories/GHSA-7jgj-8wvc-jh57
</span></span><span style="display:flex;"><span>   &gt; System.Text.RegularExpressions                     4.3.0      Moderate   https://github.com/advisories/GHSA-cmhx-cq75-c4mj
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Library.Impl.UnitTest<span style="color:#e6db74">`</span> has the following vulnerable packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>net5.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Transitive Package                    Resolved   Severity   Advisory URL                                     
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json                     12.0.3     High       https://github.com/advisories/GHSA-5crp-9r3c-p9vr
</span></span><span style="display:flex;"><span>   &gt; System.Net.Http                     4.3.0      High       https://github.com/advisories/GHSA-7jgj-8wvc-jh57
</span></span><span style="display:flex;"><span>   &gt; System.Text.RegularExpressions      4.3.0      Moderate   https://github.com/advisories/GHSA-cmhx-cq75-c4mj
</span></span></code></pre></div><p>As you can see the list of vulnerable dependencies has grown quite a bit from the previous execution.</p>
<p>To put it simply, remember to use <strong>ALWAYS</strong> the <code>--use-transitive</code> parameter when running the <code>dotnet list package --vulnerable</code> command, because the NuGet packages you have installed on your app have their own dependencies and those dependencies can be have their own dependencies, and so on and so forth. And you want to check if there is a vulnerability on the entire chain of dependencies not only on your top-level packages.</p>
<h1 id="how-to-integrate-the-net-cli-vulnerability-scan-feature-with-your-cicd-pipelines"><strong>How to integrate the .NET CLI vulnerability scan feature with your CI/CD pipelines</strong></h1>
<p>The <code>dotnet list package --vulnerable --use-transitive</code> command <strong>only LISTS</strong> vulnerabilities found on your dependencies, if a vulnerability is found within your application the dotnet CLI won&rsquo;t thrown any kind of error, which means that there is not a native way to stop the execution of a pipeline if a vulnerability is found.</p>
<p>But that&rsquo;s no excuse at all, because you can check for any known NuGet vulnerability and break the pipeline execution with just a couple of lines of bash script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dotnet list package --vulnerable --include-transitive 2&gt;&amp;<span style="color:#ae81ff">1</span> | tee build.log
</span></span><span style="display:flex;"><span>grep -q -i <span style="color:#e6db74">&#34;critical\|high\|moderate\|low&#34;</span> build.log; <span style="color:#f92672">[</span> $? -eq <span style="color:#ae81ff">0</span> <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> echo <span style="color:#e6db74">&#34;Security Vulnerabilities found on the log output&#34;</span> <span style="color:#f92672">&amp;&amp;</span> exit <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><ul>
<li>The first line runs the <code>dotnet list package --vulnerable --include-transitive</code> command and stores the result on a file named &ldquo;build.log&rdquo;</li>
<li>The second one searches the &ldquo;build.log&rdquo; file for the &ldquo;critical&rdquo;, &ldquo;high&rdquo;, &ldquo;moderate&rdquo; or &ldquo;low&rdquo; keywords. If there is a match, it breaks the pipeline execution by returning a general error.</li>
</ul>
<p>As you can see it&rsquo;s a pretty simple script, now let me show you how an Azure DevOps Pipeline and a GitHub Action will look like.</p>
<h2 id="azure-pipeline"><strong>Azure Pipeline</strong></h2>
<p>The pipeline is a run of the mill .NET pipeline (<code>dotnet restore</code>, <code>dotnet build</code>, <code>dotnet test</code> and <code>dotnet publish</code>), the only thing that&rsquo;s different is that there is an extra step where the <code>dotnet list package --vulnerable --include-transitive</code> command is being executed and evaluated.</p>
<p>It is also worth mentioning that the  <code>dotnet list package --vulnerable --include-transitive</code> command needs to run after the <code>dotnet restore</code> command.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">trigger</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#ae81ff">master</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">pool</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">vmImage</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">variables</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">buildConfiguration</span>: <span style="color:#e6db74">&#39;Release&#39;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">task</span>: <span style="color:#ae81ff">DotNetCoreCLI@2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">inputs</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#39;restore&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">projects</span>: <span style="color:#e6db74">&#39;**/*.csproj&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">displayName</span>: <span style="color:#e6db74">&#39;Restore Nuget Packages&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">task</span>: <span style="color:#ae81ff">Bash@3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">displayName</span>: <span style="color:#ae81ff">Check NuGet vulnerabilities</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">inputs</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">targetType</span>: <span style="color:#e6db74">&#39;inline&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">script</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      dotnet list package --vulnerable --include-transitive 2&gt;&amp;1 | tee build.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      echo &#34;Analyze dotnet list package command log output...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      grep -q -i &#34;critical\|high\|moderate\|low&#34; build.log; [ $? -eq 0 ] &amp;&amp; echo &#34;Security Vulnerabilities found on the log output&#34; &amp;&amp; exit 1</span>      
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">task</span>: <span style="color:#ae81ff">DotNetCoreCLI@2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">inputs</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#39;build&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">projects</span>: <span style="color:#e6db74">&#39;**/*.csproj&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">arguments</span>: <span style="color:#e6db74">&#39;--no-restore&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">displayName</span>: <span style="color:#e6db74">&#39;Build projects&#39;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">task</span>: <span style="color:#ae81ff">DotNetCoreCLI@2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">inputs</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#39;test&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">projects</span>: <span style="color:#e6db74">&#39;**/*Test.csproj&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">arguments</span>: <span style="color:#e6db74">&#39;--no-restore --no-build&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">displayName</span>: <span style="color:#e6db74">&#39;Run Tests&#39;</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">task</span>: <span style="color:#ae81ff">DotNetCoreCLI@2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">inputs</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">command</span>: <span style="color:#e6db74">&#39;publish&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">publishWebProjects</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">projects</span>: <span style="color:#e6db74">&#39;**/VulnerableApp.WebApi.csproj&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">arguments</span>: <span style="color:#e6db74">&#39;--configuration $(buildConfiguration) --no-restore&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">modifyOutputPath</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">displayName</span>: <span style="color:#e6db74">&#39;Publish Api&#39;</span>
</span></span></code></pre></div><h2 id="github-action"><strong>GitHub Action</strong></h2>
<p>The same thing happens here, the pipeline is a run of the mill .NET pipeline with an extra step where the <code>dotnet list package --vulnerable --include-transitive</code> command is being executed and evaluated.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">dotnet build pipeline checking nuget vulnerabilities</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#e6db74">&#34;main&#34;</span> ]
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pull_request</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>: [ <span style="color:#e6db74">&#34;main&#34;</span> ]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v3</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup .NET</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/setup-dotnet@v2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">dotnet-version</span>: <span style="color:#ae81ff">6.0</span><span style="color:#ae81ff">.x</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Restore dependencies</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">run</span>: <span style="color:#ae81ff">dotnet restore</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checking NuGet vulnerabilites</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        dotnet list package --vulnerable --include-transitive 2&gt;&amp;1 | tee build.log
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        echo &#34;Analyze dotnet list package command log output...&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        grep -q -i &#34;critical\|high\|moderate\|low&#34; build.log; [ $? -eq 0 ] &amp;&amp; echo &#34;Security Vulnerabilities found on the log output&#34; &amp;&amp; exit 1</span>        
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">run</span>: <span style="color:#ae81ff">dotnet build --no-restore</span>
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Test</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">run</span>: <span style="color:#ae81ff">dotnet test --no-build --verbosity normal</span>
</span></span></code></pre></div><h1 id="how-to-check-if-your-app-has-any-outdated-or-deprecated-dependencies"><strong>How to check if your app has any outdated or deprecated dependencies</strong></h1>
<p>To ensure a secure supply chain of dependencies, you will want to ensure that all of your dependencies are regularly updated to the latest stable version as they will often include the latest functionality and security patches to known vulnerabilities.</p>
<p>You can also use the dotnet CLI to list any known deprecated or outdated dependencies you may have inside your project or solution.</p>
<p>The commands you&rsquo;ll want to use are the following ones:</p>
<ul>
<li><code>dotnet list package --outdated</code></li>
<li><code>dotnet list package --deprecated</code></li>
</ul>
<h2 id="check-outdated-dependencies"><strong>Check outdated dependencies</strong></h2>
<p>The <code>dotnet list package --outdated</code> lists packages that have been outdated.</p>
<p>Here&rsquo;s how the output of the <code>dotnet list package --outdated</code> command looks like when executed on the same application I have used in the previous section.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>The following sources were used:
</span></span><span style="display:flex;"><span>   https://api.nuget.org/v3/index.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Library.Contracts<span style="color:#e6db74">`</span> has no updates given the current sources.
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Library.Impl<span style="color:#e6db74">`</span> has the following updates to its packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                                            Requested   Resolved   Latest
</span></span><span style="display:flex;"><span>   &gt; AutoMapper                                                 10.1.1      10.1.1     11.0.1
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.DependencyInjection.Abstractions      5.0.0       5.0.0      6.0.0 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.Logging                               5.0.0       5.0.0      6.0.0 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.Options.ConfigurationExtensions       5.0.0       5.0.0      6.0.0 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Repository.Contracts<span style="color:#e6db74">`</span> has no updates given the current sources.
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Repository.Impl<span style="color:#e6db74">`</span> has the following updates to its packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                                            Requested   Resolved   Latest
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.DependencyInjection.Abstractions      5.0.0       5.0.0      6.0.0 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.Options.ConfigurationExtensions       5.0.0       5.0.0      6.0.0 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Core.Extensions<span style="color:#e6db74">`</span> has the following updates to its packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package      Requested   Resolved   Latest
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json      12.0.3      12.0.3     13.0.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.WebApi<span style="color:#e6db74">`</span> has the following updates to its packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>net5.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                                          Requested   Resolved   Latest
</span></span><span style="display:flex;"><span>   &gt; AutoMapper.Extensions.Microsoft.DependencyInjection      8.1.1       8.1.1      11.0.0
</span></span><span style="display:flex;"><span>   &gt; Microsoft.AspNetCore.Authentication.JwtBearer            5.0.6       5.0.6      6.0.7 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.AspNetCore.Authentication.OpenIdConnect        5.0.6       5.0.6      6.0.7 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.AspNetCore.Mvc.NewtonsoftJson                  5.0.6       5.0.6      6.0.7 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Identity.Web                                   1.11.0      1.11.0     1.25.1
</span></span><span style="display:flex;"><span>   &gt; Newtonsoft.Json                                          12.0.3      12.0.3     13.0.1
</span></span><span style="display:flex;"><span>   &gt; Serilog.AspNetCore                                       4.1.0       4.1.0      6.0.1 
</span></span><span style="display:flex;"><span>   &gt; Serilog.Sinks.Console                                    3.1.1       3.1.1      4.0.1 
</span></span><span style="display:flex;"><span>   &gt; Serilog.Sinks.File                                       4.1.0       4.1.0      5.0.0 
</span></span><span style="display:flex;"><span>   &gt; Swashbuckle.AspNetCore                                   6.1.4       6.1.4      6.4.0 
</span></span><span style="display:flex;"><span>   &gt; Swashbuckle.AspNetCore.Annotations                       6.1.4       6.1.4      6.4.0 
</span></span><span style="display:flex;"><span>   &gt; Swashbuckle.AspNetCore.Newtonsoft                        6.1.4       6.1.4      6.4.0 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.WebApi.IntegrationTest<span style="color:#e6db74">`</span> has the following updates to its packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>net5.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                       Requested   Resolved   Latest
</span></span><span style="display:flex;"><span>   &gt; coverlet.collector                    1.3.0       1.3.0      3.1.2 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.AspNetCore.Mvc.Testing      5.0.6       5.0.6      6.0.7 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.NET.Test.Sdk                16.7.1      16.7.1     17.2.0
</span></span><span style="display:flex;"><span>   &gt; xunit                                 2.4.1       2.4.1      2.4.2 
</span></span><span style="display:flex;"><span>   &gt; xunit.runner.visualstudio             2.4.3       2.4.3      2.4.5 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Library.Impl.UnitTest<span style="color:#e6db74">`</span> has the following updates to its packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>net5.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                Requested   Resolved   Latest
</span></span><span style="display:flex;"><span>   &gt; coverlet.collector             1.3.0       1.3.0      3.1.2 
</span></span><span style="display:flex;"><span>   &gt; Microsoft.NET.Test.Sdk         16.7.1      16.7.1     17.2.0
</span></span><span style="display:flex;"><span>   &gt; Moq                            4.16.1      4.16.1     4.18.2
</span></span><span style="display:flex;"><span>   &gt; xunit                          2.4.1       2.4.1      2.4.2 
</span></span><span style="display:flex;"><span>   &gt; xunit.runner.visualstudio      2.4.3       2.4.3      2.4.5 
</span></span></code></pre></div><p>Having an outdated package is not as problematic as having a vulnerable one, but nonetheless it is good to know about them.<br>
In this case I&rsquo;m evaluating a .NET5 app that was built a couple years ago, so it is completely normal that some of the dependencies are outdated.</p>
<p>The <code>dotnet list package --outdated</code> command only checks for outdated references on the top-level packages, if you want to check for outdated dependencies in the entire chain of dependencies you can use the <code>--use-transitive</code> parameter.</p>
<h2 id="check-deprecated-dependencies"><strong>Check deprecated dependencies</strong></h2>
<p>The <code>dotnet list package --deprecated</code> lists packages that have been deprecated.</p>
<p>Here&rsquo;s how the output of the <code>dotnet list package --deprecated</code> command looks like when executed on the same application I have used in the previous section.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>The following sources were used:
</span></span><span style="display:flex;"><span>   https://api.nuget.org/v3/index.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Library.Contracts<span style="color:#e6db74">`</span> has no deprecated packages given the current sources.
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Library.Impl<span style="color:#e6db74">`</span> has the following deprecated packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                                            Requested   Resolved   Reason<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>      Alternative
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.DependencyInjection.Abstractions      5.0.0       5.0.0      Other,Legacy              
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.Logging                               5.0.0       5.0.0      Other,Legacy              
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.Options.ConfigurationExtensions       5.0.0       5.0.0      Other,Legacy              
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Repository.Contracts<span style="color:#e6db74">`</span> has no deprecated packages given the current sources.
</span></span><span style="display:flex;"><span>Project <span style="color:#e6db74">`</span>VulnerableApp.Repository.Impl<span style="color:#e6db74">`</span> has the following deprecated packages
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">[</span>netstandard2.0<span style="color:#f92672">]</span>: 
</span></span><span style="display:flex;"><span>   Top-level Package                                            Requested   Resolved   Reason<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>      Alternative
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.DependencyInjection.Abstractions      5.0.0       5.0.0      Other,Legacy              
</span></span><span style="display:flex;"><span>   &gt; Microsoft.Extensions.Options.ConfigurationExtensions       5.0.0       5.0.0      Other,Legacy              
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Core.Extensions<span style="color:#e6db74">`</span> has no deprecated packages given the current sources.
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.WebApi<span style="color:#e6db74">`</span> has no deprecated packages given the current sources.
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.WebApi.IntegrationTest<span style="color:#e6db74">`</span> has no deprecated packages given the current sources.
</span></span><span style="display:flex;"><span>The given project <span style="color:#e6db74">`</span>VulnerableApp.Library.Impl.UnitTest<span style="color:#e6db74">`</span> has no deprecated packages given the current sources.
</span></span></code></pre></div><p>.NET5 reached the &ldquo;End of Support&rdquo; status a couple of months ago, that&rsquo;s the reason why the scan is telling me that those 5.0.0 dependencies are deprecated.</p>
<p>The <code>dotnet list package --deprecated</code>  only checks for deprecated references on the top-level packages, if you want to check for outdated dependencies in the entire chain of dependencies you can use the <code>--use-transitive</code> parameter.</p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://www.mytechramblings.com/posts/keep-your-platform-images-updated-when-using-aws-ecr-with-azure-pipelines/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Keep your .NET platform images up to date using AWS ECR and Azure Pipelines</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://www.mytechramblings.com/posts/deploying-a-signalr-core-app-on-aws/">
                  <span class="button__text">How to deploy a SignalR Core application to AWS</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2024 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="https://www.mytechramblings.com/assets/main.js"></script>
<script src="https://www.mytechramblings.com/assets/prism.js"></script>
<script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
<script>
  kofiWidgetOverlay.draw('carlospons', {
    'type': 'floating-chat',
    'floating-chat.donateButton.text': 'Donate',
    'floating-chat.donateButton.background-color': '#ff5f5f',
    'floating-chat.donateButton.text-color': '#fff'
  });
</script>

      
    </div>

    
      
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-C5HMQCEWM1"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-C5HMQCEWM1');
        }
      </script>
    
  


    
  </body>
</html>
