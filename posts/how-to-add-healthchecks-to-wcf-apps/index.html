<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Why and how you should add a healthcheck endpoint to your Wcf legacy applications :: my tech ramblings — A blog for writing about my techie ramblings</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Nowadays no one on his right mind is going to create a WCF from scratch. It really makes no sense to do it. It&amp;rsquo;s a deprecated technology, it does not work with .NET Core, only works on Windows OS and personally I found the configuration confusing as hell, every time I need to modify an existing one I have to spend a good amount of time trying to figure out what everything means."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://www.mytechramblings.com/posts/how-to-add-healthchecks-to-wcf-apps/" />





<link rel="stylesheet" href="https://www.mytechramblings.com/assets/style.css">


<link rel="stylesheet" href="https://www.mytechramblings.com/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://www.mytechramblings.com/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://www.mytechramblings.com/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Why and how you should add a healthcheck endpoint to your Wcf legacy applications"/>
<meta name="twitter:description" content="Nowadays no one on his right mind is going to create a WCF from scratch. It really makes no sense to do it. It&rsquo;s a deprecated technology, it does not work with .NET Core, only works on Windows OS and personally I found the configuration confusing as hell, every time I need to modify an existing one I have to spend a good amount of time trying to figure out what everything means."/>



<meta property="og:title" content="Why and how you should add a healthcheck endpoint to your Wcf legacy applications" />
<meta property="og:description" content="Nowadays no one on his right mind is going to create a WCF from scratch. It really makes no sense to do it. It&rsquo;s a deprecated technology, it does not work with .NET Core, only works on Windows OS and personally I found the configuration confusing as hell, every time I need to modify an existing one I have to spend a good amount of time trying to figure out what everything means." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.mytechramblings.com/posts/how-to-add-healthchecks-to-wcf-apps/" />
<meta property="article:published_time" content="2020-07-04T17:30:06+02:00" />
<meta property="article:modified_time" content="2020-07-04T17:30:06+02:00" /><meta property="og:site_name" content="my tech ramblings" />






  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="https://www.mytechramblings.com/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">my tech ramblings</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="https://www.mytechramblings.com/posts/how-to-add-healthchecks-to-wcf-apps/">Why and how you should add a healthcheck endpoint to your Wcf legacy applications</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-07-04
        </span>

        
          
        
      

      
      
        <span class="post-read-time">— 8 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="https://www.mytechramblings.com/tags/dotnet/">dotnet</a>&nbsp;
        
          #<a href="https://www.mytechramblings.com/tags/.net/">.NET</a>&nbsp;
        
          #<a href="https://www.mytechramblings.com/tags/wcf/">wcf</a>&nbsp;
        
          #<a href="https://www.mytechramblings.com/tags/legacy/">legacy</a>&nbsp;
        
          #<a href="https://www.mytechramblings.com/tags/csharp/">csharp</a>&nbsp;
        
          #<a href="https://www.mytechramblings.com/tags/azure/">azure</a>&nbsp;
        
          #<a href="https://www.mytechramblings.com/tags/appservices/">appservices</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <p>Nowadays no one on his right mind is going to create a WCF from scratch. It really makes no sense to do it. It&rsquo;s a deprecated technology, it does not work with .NET Core, only works on Windows OS and personally I found the configuration confusing as hell, every time I need to modify an existing one I have to spend a good amount of time trying to figure out what everything means.</p>
<p>If you are not old enough, probably you&rsquo;re asking yourself: <em>&ldquo;What the hell is WCF?&quot;</em>.<br>
WCF stands for &ldquo;Windows Communication Foundation&rdquo;, and if you want to know more about read the official Microsoft docs: <a href="https://docs.microsoft.com/es-es/dotnet/framework/wcf/whats-wcf">here</a></p>
<p>If you want to build a .NET application from scratch right now, most likely you are going to build an app using .NET Core, probably is going to use REST over HTTP or even GRPC and it is also pretty likely that you are going to host it in a container platform, a serverless function or a Paas platform like Azure App Services.<br>
But let&rsquo;s be honest if you&rsquo;re working for an old enough company and a company that uses .NET as its main stack, it&rsquo;s pretty likely that you are going to stumble with a bunch of legacy applications in some lost server and I&rsquo;m pretty sure you are going to find some WCF applications among them.<br>
These past few years I worked as a freelance quite few times and I know as a fact that a lot of .NET shops are still running WCFs nowadays.</p>
<p>What I wanted to talk in these post is how easy is to add a healthcheck endpoint in a WCF application, and how you can use it in case you want to move the application into the Cloud in the near future.</p>
<blockquote>
<p>With the expansion of cloud computing and also with the huge adoption of Kubernetes almost everyone knows what a healthcheck endpoint is and why is good to have one in your application, so I&rsquo;m gonna skip that part.</p>
</blockquote>
<p>I&rsquo;m also aware that in .NET 4.8 Microsoft added the possibility to add a healthcheck endpoint in your WCF application using a <strong>ServiceHealthBehavior</strong><br>
But I&rsquo;m going to give another option, that option is to build a healthcheck REST endpoint inside your WCF application.<br>
Having multiple options is always nice and maybe in your company they cannot update the .NET framework version to the latest version.</p>
<h1 id="build-the-healthcheck-library-for-wcf">Build the healthcheck library for wcf</h1>
<blockquote>
<p>I push the code into my personal github if you want to check it out:  <a href="https://github.com/karlospn/healthchecks-wcf">wcf-healthcheck-code</a></p>
</blockquote>
<p>I&rsquo;m going to create a class library so I can pack it and use it as a nuget.</p>
<ul>
<li>First of all I define the response object that the healthcheck is going to return.<br>
The healthcheck is going to return a <em>&ldquo;HealthCheckResponse&rdquo;</em> that contains a descriptive message and the status of our service: <em>Healthy</em>, <em>Unhealthy</em> or <em>Degraded</em></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">using</span> System.Runtime.Serialization;

<span style="color:#66d9ef">namespace</span> HealthChecks.Wcf
{
<span style="color:#a6e22e">    [DataContract]</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HealthCheckResponse</span>
    {
<span style="color:#a6e22e">
</span><span style="color:#a6e22e">        [DataMember]</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Status { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }
<span style="color:#a6e22e">
</span><span style="color:#a6e22e">        [DataMember]</span>
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Message { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }

    }
}
</code></pre></div><ul>
<li>Next step is to define the contract.<br>
The endpoint created is going to be located under the <em>/check</em> uri</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">using</span> System.ServiceModel;
<span style="color:#66d9ef">using</span> System.ServiceModel.Web;

<span style="color:#66d9ef">namespace</span> HealthChecks.Wcf
{
<span style="color:#a6e22e">    [ServiceContract(Name =&#34;health&#34;)]</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> IHealthCheckService
    {
<span style="color:#a6e22e">        [OperationContract]</span>
<span style="color:#a6e22e">        [WebInvoke(
</span><span style="color:#a6e22e">            Method = &#34;GET&#34;, 
</span><span style="color:#a6e22e">            UriTemplate = &#34;/check&#34;, 
</span><span style="color:#a6e22e">            BodyStyle = WebMessageBodyStyle.Bare,
</span><span style="color:#a6e22e">            RequestFormat = WebMessageFormat.Json, 
</span><span style="color:#a6e22e">            ResponseFormat = WebMessageFormat.Json)]</span>
        HealthCheckResponse CheckHealth();
    }
}

</code></pre></div><ul>
<li>Next step is to implement the <em>CheckHealth</em> method that I defined in the <em>IHealthCheckService</em> interface.</li>
</ul>
<p>Notice that I  created an abstract class that defines an abstract method: <em>ExecuteHealthCheck()</em> , that&rsquo;s because the <em>ExecuteHealthcheck</em> method needs to be implemented by the client app and it will contain the healthcheck logic that the client want to check.</p>
<p>The <em>HealthCheckBase</em> is going to fetch the result of the <em>ExecuteHealthCheck</em> method, map from the method response to the response object and return a result.<br>
In case the healthcheck fails it will return a WebFaultException with a 500 status code, and if the healthcheck succeeds with a healthy or degraded status it will return a 200 OK.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">using</span> System.Net;
<span style="color:#66d9ef">using</span> System.ServiceModel.Web;
<span style="color:#66d9ef">using</span> HealthChecks.Wcf.Enums;

<span style="color:#66d9ef">namespace</span> HealthChecks.Wcf
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HealthCheckBase</span> : IHealthCheckService
    {
        <span style="color:#66d9ef">public</span> HealthCheckResponse CheckHealth()
        {
            <span style="color:#66d9ef">var</span> result = EvaluateHealthCheck();
            <span style="color:#66d9ef">return</span> MappedResultToResponse(result);

        }

        <span style="color:#66d9ef">private</span> HealthCheckResult EvaluateHealthCheck()
        {
            <span style="color:#66d9ef">var</span> healthCheckResult = ExecuteHealthCheck();

            <span style="color:#66d9ef">if</span> (healthCheckResult == <span style="color:#66d9ef">null</span> || 
                <span style="color:#66d9ef">string</span>.IsNullOrEmpty(healthCheckResult.Message))
            {
                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> WebFaultException&lt;<span style="color:#66d9ef">string</span>&gt;(
                    <span style="color:#e6db74">&#34;Something when wrong on your healthcheck. Check your implementation&#34;</span>, 
                    HttpStatusCode.InternalServerError);

            }
            <span style="color:#66d9ef">if</span> (healthCheckResult.Status == HealthStatus.Unhealthy)
            {
                <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> WebFaultException&lt;HealthCheckResult&gt;(
                    healthCheckResult, 
                    HttpStatusCode.InternalServerError);
            }

            <span style="color:#66d9ef">return</span> healthCheckResult;
        }

        <span style="color:#66d9ef">private</span> HealthCheckResponse MappedResultToResponse(HealthCheckResult result)
        {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> HealthCheckResponse
            {
                Status = result.Status.ToString(),
                Message = result.Message
            };
        }

        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">abstract</span> HealthCheckResult ExecuteHealthCheck();
    }

}


<span style="color:#66d9ef">using</span> HealthChecks.Wcf.Enums;

<span style="color:#66d9ef">namespace</span> HealthChecks.Wcf
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HealthCheckResult</span>
    {

        <span style="color:#66d9ef">public</span> HealthStatus Status  {<span style="color:#66d9ef">get</span>;<span style="color:#66d9ef">set</span>;}

        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">string</span> Message { <span style="color:#66d9ef">get</span>; <span style="color:#66d9ef">set</span>; }

    }
}

<span style="color:#66d9ef">namespace</span> HealthChecks.Wcf.Enums
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">enum</span> HealthStatus
    {
        Healthy,
        Unhealthy,
        Degraded
    }
}

</code></pre></div><ul>
<li>Last step is to wire everything up.<br>
When the serviceHost is opening the connection we use it to create a ServiceEndpoint with a WebHttpBinding.<br>
Basically that will allow us to create a new REST endpoint in our WCF application.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">using</span> System;
<span style="color:#66d9ef">using</span> System.Collections.Generic;
<span style="color:#66d9ef">using</span> System.Linq;
<span style="color:#66d9ef">using</span> System.Reflection;
<span style="color:#66d9ef">using</span> System.ServiceModel;
<span style="color:#66d9ef">using</span> System.ServiceModel.Description;

<span style="color:#66d9ef">namespace</span> HealthChecks.Wcf
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HealthCheckExtensions</span>
    {
        <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Action&lt;ServiceHostBase&gt; AddHealthCheckEndpoint()
        {
            <span style="color:#66d9ef">return</span> serviceHost =&gt;
            {
                serviceHost.Opening += (snd, args) =&gt;
                     {
                         GenerateHealthEndpoint(serviceHost);
                     };
            };
        }

        <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> GenerateHealthEndpoint(ServiceHostBase serviceHost)
        {
            <span style="color:#66d9ef">var</span> implementedContracts = serviceHost
                .GetType()
                .GetProperty(<span style="color:#e6db74">&#34;ImplementedContracts&#34;</span>, BindingFlags.Instance | BindingFlags.NonPublic | BindingFlags.GetField);

            <span style="color:#66d9ef">if</span> (implementedContracts != <span style="color:#66d9ef">null</span>)
            {
                <span style="color:#66d9ef">var</span> contractDic = (Dictionary&lt;<span style="color:#66d9ef">string</span>, ContractDescription&gt;)implementedContracts.GetValue(serviceHost, <span style="color:#66d9ef">null</span>);
                <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> contract <span style="color:#66d9ef">in</span> contractDic.Values)
                {
                    <span style="color:#66d9ef">if</span> (serviceHost.Description.Endpoints.Any())
                    {
                        <span style="color:#66d9ef">continue</span>;
                    }

                    <span style="color:#66d9ef">if</span> (contract.ConfigurationName == <span style="color:#66d9ef">typeof</span>(IHealthCheckService).FullName)
                    {
                        <span style="color:#66d9ef">var</span> serviceEndpoint = <span style="color:#66d9ef">new</span> ServiceEndpoint(contract, 
                            <span style="color:#66d9ef">new</span> WebHttpBinding(), 
                            <span style="color:#66d9ef">new</span> EndpointAddress(serviceHost.BaseAddresses[<span style="color:#ae81ff">0</span>]));

                        serviceEndpoint.Behaviors.Add(<span style="color:#66d9ef">new</span> WebHttpBehavior());
                        serviceHost.AddServiceEndpoint(serviceEndpoint);
                    }
                }
            }

        }
    }
}

</code></pre></div><p>And that&rsquo;s it, we have built a library capable of adding a healthcheck REST endpoint into our WCF application in less than 200 lines of code.</p>
<h1 id="test-the-library">Test the library</h1>
<p>Begin by creating a new WCF from scratch and adding a new csharp class that inherits from <em>HealthCheckBase</em>.<br>
The class needs to implement the <em>ExecuteHealthCheck</em> method. The method will contain our health checking code. In my case I&rsquo;m returning directly an OK result.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">using</span> HealthChecks.Wcf.Enums;

<span style="color:#66d9ef">namespace</span> HealthChecks.Wcf.IntegrationTest
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyHealthCheckService</span> : HealthCheckBase 
    {

        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> HealthCheckResult ExecuteHealthCheck()
        {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> HealthCheckResult
            {
                Message = <span style="color:#e6db74">&#34;Everything runs smoothly&#34;</span>,
                Status = HealthStatus.Healthy
            };
        
        }

    }
}

</code></pre></div><p>Next we need to register everything on our IoC container.
I&rsquo;m using Autofac, so I need to follow the steps that Autofac dictates when you&rsquo;re registering the dependencies in a WCF.<br>
You can use the IoC container that best suits your necessities, just look it up at the documentation what steps you need to follow.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp">  <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> Application_Start(<span style="color:#66d9ef">object</span> sender, EventArgs e)
        {
            <span style="color:#66d9ef">var</span> builder = <span style="color:#66d9ef">new</span> ContainerBuilder();
            builder.RegisterType&lt;Service1&gt;().As&lt;IService1&gt;();
            builder.RegisterType&lt;MyHealthCheckService&gt;();
            <span style="color:#66d9ef">var</span> container = builder.Build();

            AutofacHostFactory.Container = container;
            AutofacHostFactory.HostConfigurationAction = HealthCheckExtensions.AddHealthCheckEndpoint();
        }

</code></pre></div><p>We are creating a service without a .svc file, to do it with Autofac you need to add the following lines in the web.config.</p>
<p>If you want more information about how to add a svc-less service using Autofac read it from the offical documentation <a href="https://autofaccn.readthedocs.io/en/latest/integration/wcf.html#svc-less-services">here</a></p>
<p>As I said before if you&rsquo;re using another IoC container just search in the documentation how to create a svc-less service.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">  <span style="color:#f92672">&lt;serviceHostingEnvironment</span> <span style="color:#a6e22e">aspNetCompatibilityEnabled=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#a6e22e">multipleSiteBindingsEnabled=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;serviceActivations&gt;</span>
       <span style="color:#f92672">&lt;add</span> <span style="color:#a6e22e">relativeAddress=</span><span style="color:#e6db74">&#34;health.svc&#34;</span> <span style="color:#a6e22e">service=</span><span style="color:#e6db74">&#34;HealthChecks.Wcf.IntegrationTest.MyHealthCheckService, HealthChecks.Wcf.IntegrationTest&#34;</span> <span style="color:#a6e22e">factory=</span><span style="color:#e6db74">&#34;Autofac.Integration.Wcf.AutofacServiceHostFactory, Autofac.Integration.Wcf&#34;</span><span style="color:#f92672">/&gt;</span>
      <span style="color:#f92672">&lt;/serviceActivations&gt;</span>
    <span style="color:#f92672">&lt;/serviceHostingEnvironment&gt;</span>
</code></pre></div><p>The REST endpoint is going to be located in the uri : <em><strong>/health.svc/check</strong></em></p>
<p>Now run the application and test the REST endpoint:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -i http://localhost:39150/health.svc/check
HTTP/1.1 <span style="color:#ae81ff">200</span> OK
Cache-Control: private
Content-Type: application/json; charset<span style="color:#f92672">=</span>utf-8
Server: Microsoft-IIS/10.0
Set-Cookie: ASP.NET_SessionId<span style="color:#f92672">=</span>04nkjaxw1h32o0jwybcpzgil; path<span style="color:#f92672">=</span>/; HttpOnly; SameSite<span style="color:#f92672">=</span>Lax
X-AspNet-Version: 4.0.30319
X-SourceFiles: <span style="color:#f92672">=</span>?UTF-8?B?RDpcTkVUIFByb2plY3RzXGhlYWx0aGNoZWNrcy13Y2ZcdGVzdFxBVEMuSGVhbHRoQ2hlY2tzLldjZi5JbnRlZ3JhdGlvblRlc3RcaGVhbHRoLnN2Y1xjaGVjaw<span style="color:#f92672">==</span>?<span style="color:#f92672">=</span>
X-Powered-By: ASP.NET
Date: Sat, <span style="color:#ae81ff">04</span> Jul <span style="color:#ae81ff">2020</span> 20:39:39 GMT
Content-Length: <span style="color:#ae81ff">57</span>

</code></pre></div><p>Now modify the healthcheck class to make it fail:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-csharp" data-lang="csharp"><span style="color:#66d9ef">using</span> HealthChecks.Wcf.Enums;

<span style="color:#66d9ef">namespace</span> HealthChecks.Wcf.IntegrationTest
{
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyHealthCheckService</span> : HealthCheckBase 
    {

        <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">override</span> HealthCheckResult ExecuteHealthCheck()
        {
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> HealthCheckResult
            {
                Message = <span style="color:#e6db74">&#34;Everything is failing smoothly&#34;</span>,
                Status = HealthStatus.Unhealthy
            };
        
        }

    }
}
</code></pre></div><p>And test it again:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">HTTP/1.1 <span style="color:#ae81ff">500</span> Internal Server Error
Cache-Control: private
Content-Type: application/json; charset<span style="color:#f92672">=</span>utf-8
Server: Microsoft-IIS/10.0
X-AspNet-Version: 4.0.30319
Set-Cookie: ASP.NET_SessionId<span style="color:#f92672">=</span>vktoksbu5nuzjovhhqryt1iq; path<span style="color:#f92672">=</span>/; HttpOnly; SameSite<span style="color:#f92672">=</span>Lax
X-SourceFiles: <span style="color:#f92672">=</span>?UTF-8?B?RDpcTkVUIFByb2plY3RzXGhlYWx0aGNoZWNrcy13Y2ZcdGVzdFxBVEMuSGVhbHRoQ2hlY2tzLldjZi5JbnRlZ3JhdGlvblRlc3RcaGVhbHRoLnN2Y1xjaGVjaw<span style="color:#f92672">==</span>?<span style="color:#f92672">=</span>
X-Powered-By: ASP.NET
Date: Sat, <span style="color:#ae81ff">04</span> Jul <span style="color:#ae81ff">2020</span> 20:41:56 GMT
Content-Length: <span style="color:#ae81ff">46</span>

</code></pre></div><h1 id="azure">Azure</h1>
<p>I said that adding a healthcheck into your WCF could be a first step towards a lift-and-shift migration into Azure, but why I said that?</p>
<p>Well that&rsquo;s because if you&rsquo;re going to move an existing WCF into Azure hands down the best option is to use Azure App Services. And if you have implemented a healthcheck endpoint in your WCF you can totally put it to good use.</p>
<p>Azure Web Apps contains a Health Check feature and is used to prevent unhealthy instance(s) from serving requests, thus improving availability. The feature will ping the specified health check path on all instances of your webapp every 2 minutes.<br>
Just open the Resource Explorer find and element named &ldquo;healthCheckPath&rdquo; and set its value to the health path of your Wcf application: <strong><em>/health.svc/check</em></strong></p>
<p><img src="/img/healthcheck-web-app.png" alt="healthcheck"></p>
<p>If you want to know more information about the healthcheck feature in Azure Web App Services you can read it from the Project Kudu github page: <a href="https://github.com/projectkudu/kudu/wiki/Health-Check-(Preview)">here</a></p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://www.mytechramblings.com/posts/how-to-use-a-private-nuget-feed-with-docker/">
                  <span class="button__icon">←</span>
                  <span class="button__text">How to Restore a Nuget from an Azure DevOps Private Feed within Docker</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://www.mytechramblings.com/posts/enforce-your-dotnet-apps-framework-version-using-roslyn-analyzers/">
                  <span class="button__text">Enforce the use of a specific .NET Core version using Roslyn</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2020 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="https://www.mytechramblings.com/assets/main.js"></script>
<script src="https://www.mytechramblings.com/assets/prism.js"></script>

      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-170300931-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
  </body>
</html>
